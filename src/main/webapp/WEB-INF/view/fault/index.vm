#set($path = ${rc.contextPath})
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>缺陷查询</title>
    #parse('common/path-js.vm')
    <link href="$path/static/css/font.css" rel="stylesheet">
    <link href="$path/static/css/style.css" rel="stylesheet">
    <link href="$path/static/css/bootstrap.css" rel="stylesheet">
    <link href="$path/static/css/newStyle.css" rel="stylesheet">
    <link href="$path/static/css/zTreeStyle.css" rel="stylesheet">
    <link href="$path/static/css/bootstrap-datetimepicker.css" rel="stylesheet">
    <script src="$path/static/js/bootstrap-datetimepicker.js" type="text/javascript"></script>
    <script src="$path/static/js/ztree/ztree.core.js" type="text/javascript"></script>
    <script src="$path/static/js/ztree/ztree.exedit.js" type="text/javascript"></script>
    <script src="$path/static/js/ztree/ztree.js" type="text/javascript"></script>
    <script src="$path/static/js/jqgrid/grid.locale-cn.js" type="text/ecmascript"></script>
    <script src="$path/static/js/jqgrid/jquery.jqGrid.min.js" type="text/ecmascript"></script>
</head>
<body>
<div class="wrapper">
    <div class="right defectRight" style="margin-left:0;">
        <p class="heading">检测数据
        	<a class="btn-search" href="javascript:getTableData();">查询</a>
        	<a class="btn-export" href="javascript:;">导出</a>
        </p>
        <div class="defect-container">
            <form class="control-condition" id="faultForm">
            	<div class="form-inline">
                    <label>故障类型：</label>
                    <a class="selectTree" href="#faultType" data-toggle="modal" data-target="#faultType"></a>
                    <!-- <select name="type" id="type" class=" reset-input">
                        <option value="">请选择</option>
                        #foreach($dic in $!dics)
                            <option value="$!dic.nodeCode">$!dic.nodeName</option>
                        #end
                    </select> -->
                </div>
                <div class="form-inline">
                    <label>创建时间：</label>
                    <div class="input-group datetimepicker start_time">
                        <input type="text" id="timeon" name="beginTime">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                    </div>
                    <span>至</span>
                    <div class="input-group datetimepicker end_time">
                        <input type="text" id="timeoff" name="endTime">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                    </div>
                </div>
                <div class="form-inline">
                    <label>列车号：</label>
                    <input type="text" id="carNumber" name="carNumber">
                </div>
                <div class="clear"></div>
            </form>
            <!-- 表格 start -->
            <div class="table-container">
                <table id="faultTable"></table>
                <div id="page" class="page"></div>
            </div>
            <!-- 表格 end -->
        </div>
    </div>
</div>
<!-- 故障类型 -->
<div class="modal" id="faultType" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " role="document">
        <div class="modal-content">
            <div class="modal-header">
                <a href="javascript:;" class="close icon-8" data-dismiss="modal" aria-label="Close"></a>
                <h4 class="modal-title">故障类型</h4>
            </div>
            <div class="modal-body">
                <div class="treeDemo">
		            <ul id="treeDemo" class="ztree"></ul>
		        </div>
            </div>
            <div class="modal-footer">
                <a class="btn btn-confirm" href="javascript:;">确定</a>
                <button class="btn btn-cancel" href="javascript:;" data-dismiss="modal" aria-label="Close">取消</button>
            </div>
        </div>
    </div>
</div>
<!-- 故障类型 -->
<script type="text/javascript">
    $(function () {
        tableInit();
    });
    function tableInit() {
        $("#faultTable").jqGrid({
            url:"$path/faults",
            datatype:"json",
            mtype:"get",
            postData: {
                search : JSON.stringify($('#faultForm').serializeObject())
            },
            colNames:['线路','车号','弓位置','区间',"缺陷类型","缺陷级别","缺陷信息","操作"],
            colModel:[
                {name:'line', width:'10%'},
                {name:'carNumber', width:'10%'},
                {name:'bowPosition', width:'20%'},
                {name:'interval', width:'20%'},
                {name:'dic.nodeName', width:'10%'},
                {name:'level', width:'10%'},
                {name:'faultInfo', width:'10%'},
                {name:'operation', width:'10%',formatter:function(cellvalue,options,rowObject){
                    var str = '<a href="$path/faults/'+rowObject.faultId+'">详情</a>';
                    return str;
                }},
            ],
            viewrecords: true,//是否在浏览导航栏显示记录总数
            autowidth:true,
            height:'auto',
            rowNum:10,//每页显示记录数
            pager:$('#page'),
            jsonReader:{
                page: "page",
                total: "pages",
                records: "count",
                root: "results",
                repeatitems: false,
                id: "faultId"
            }
        });
    }
    function getTableData() {
        $("#faultTable").jqGrid('setGridParam',{
            postData: {
                search : JSON.stringify($('#faultForm').serializeObject())
            }
        }).trigger('reloadGrid');
    }
</script>
</body>
</html>